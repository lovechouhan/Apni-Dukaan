<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
 xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
 layout:decorate="~{base}">
<head>
   
    <title>eg</title>
</head>
<body>
    <div layout:fragment="content" class="min-h-screen overflow-auto">

        <section class="max-w-xl mx-auto p-6 bg-red-100 rounded shadow">
            <!-- Only show for locally registered users -->
            <div>
                <h2 class="text-2xl font-semibold mb-4">Change Password</h2>

                <form th:action="@{/user/settings/change-password}" method="post" novalidate id="changePasswordForm">
                    <!-- CSRF token (Spring Security) -->
                    <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /> -->

                    <!-- Server-side error/success messages -->
                    <div th:if="${error}" class="mb-3 text-red-600" th:text="${error}"></div>
                    <div th:if="${success}" class="mb-3 text-green-600" th:text="${success}"></div>

                    <div class="mb-4">
                        <label for="currentPassword" class="block mb-1">Current password</label>
                        <input id="currentPassword" name="currentPassword" type="password" required class="w-full p-2 border rounded" />
                    </div>

                    <div class="mb-4">
                        <label for="newPassword" class="block mb-1">New password</label>
                        <input id="newPassword" name="newPassword" type="password" required class="w-full p-2 border rounded" />
                        <small class="text-gray-600">Minimum 8 characters.</small>
                    </div>

                    <div class="flex items-center gap-3">
                        <button type="submit" id="submitBtn" class="px-4 py-2 bg-red-800 text-white rounded">Update password</button>
                        <a th:href="@{/user/settings}" class="text-sm text-gray-600">Cancel</a>
                    </div>
                </form>
            </div>

            <!-- For non-local users show informative message -->
            

            <script>
                (function(){
                    var form = document.getElementById('changePasswordForm');
                    if (!form) return;
                    var newPwd = document.getElementById('newPassword');
                    var confirmPwd = document.getElementById('confirmPassword');
                    var matchError = document.getElementById('matchError');
                    var submitBtn = document.getElementById('submitBtn');

                    function validateMatch() {
                        if (!newPwd.value || !confirmPwd.value) {
                            matchError.style.display = 'none';
                            submitBtn.disabled = false;
                            return;
                        }
                        if (newPwd.value !== confirmPwd.value) {
                            matchError.style.display = 'block';
                            submitBtn.disabled = true;
                        } else {
                            matchError.style.display = 'none';
                            submitBtn.disabled = false;
                        }
                    }

                    newPwd.addEventListener('input', validateMatch);
                    confirmPwd.addEventListener('input', validateMatch);

                    form.addEventListener('submit', function(e){
                        // final client-side check
                        if (newPwd.value !== confirmPwd.value) {
                            e.preventDefault();
                            matchError.style.display = 'block';
                            confirmPwd.focus();
                        }
                    });
                })();
            </script>
        </section>
    </div>

</body>
</html>