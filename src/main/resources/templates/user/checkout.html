<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
 xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
 layout:decorate="~{base}">
<head>
   
    <title>Checkout</title>
</head>
<body>
        <div layout:fragment="content" class="min-h-screen overflow-auto bg-red-300 flex flex-col items-center justify-center py-12">
            <div class="w-full max-w-3xl mx-auto px-4">
                <!-- Card Container -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <!-- Stepper -->
                    <div class="px-6 pt-8 pb-4 border-b border-gray-200">
                            <ol id="stepper" class="flex items-center w-full text-sm font-medium text-center text-gray-500 sm:text-base">
                                <li class="flex-1 flex items-center after:content-[''] after:flex-1 after:border-b-2 after:mx-2" id="step-1">
                                    <span class="flex items-center gap-2">
                                        <span class="w-7 h-7 flex items-center justify-center rounded-full step-circle">1</span>
                                        Shipping
                                    </span>
                                </li>
                                
                                <li class="flex-1 flex items-center after:content-[''] after:flex-1 after:border-b-2 after:mx-2" id="step-2">
                                    <span class="flex items-center gap-2">
                                        <span class="w-7 h-7 flex items-center justify-center rounded-full step-circle">2</span>
                                        Payment
                                    </span>
                                </li>
                                <li class="flex-1 flex items-center" id="step-3">
                                    <span class="flex items-center gap-2">
                                        <span class="w-7 h-7 flex items-center justify-center rounded-full step-circle">3</span>
                                        Order Summary
                                    </span>
                                </li>

                                
                            </ol>
                            
                        </div>

                        <style>
                            .step-circle {
                                background-color: #d1d5db; /* gray-300 */
                                color: #4b5563; /* gray-600 */
                            }
                            .active-step .step-circle {
                                background-color: #020408; /* blue-600 */
                                color: #fff;
                            }
                            .active-step {
                                color: #020408;
                            }
                            .active-step + li .after\:border-b-2 {
                                border-color: #020408 !important;
                            }
                        </style>
                        <script>
                            let currentStep = 1;
                            const totalSteps = 3;
                            function updateStepper() {
                                for (let i = 1; i <= totalSteps; i++) {
                                    const step = document.getElementById('step-' + i);
                                    if (i === currentStep) {
                                        step.classList.add('active-step');
                                    } else {
                                        step.classList.remove('active-step');
                                    }
                                }
                            }
                            document.addEventListener('DOMContentLoaded', function() {
                                updateStepper();
                                document.getElementById('nextStepBtn').addEventListener('click', function() {
                                    if (currentStep < totalSteps) {
                                        currentStep++;
                                        updateStepper();
                                    }
                                });
                            });
                        </script>

              
                <main class="p-6 md:p-8">
                    <!-- Shipping Section -->
                    <section class="space-y-6">
                        <h2 class="text-xl font-semibold">Shipping Address</h2>
                        <form th:action="@{/api/payments/create-order}" method="post" class="space-y-4">
                            <input type="text" name="fullName" placeholder="Full Name" required 
                                class="w-full border border-red-200 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <input type="text" name="streetAddress" placeholder="Street Address" required 
                                class="w-full border border-red-200 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <input type="email" name="email" placeholder="Email Address" required
                                class="w-full border border-red-200 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" name="city" placeholder="City" required 
                                    class="w-full border border-red-200 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                                <input type="text" name="state" placeholder="State" required 
                                    class="w-full border border-red-200 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" name="zipCode" placeholder="ZIP Code" required 
                                    class="w-full border border-red-200 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                                <input type="tel" name="mobile" placeholder="Mobile Number" required pattern="[0-9]{10}" 
                                    class="w-full border border-red-200 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">

                                   

                            <div class="flex justify-end mt-6">
                                <button type="button" class="bg-red-800 text-white px-8 py-3 rounded-lg hover:bg-gray-900 transition-colors font-medium" id="pay-button">Continue to Payment</button>
                                <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

                                <script>
                                    document.getElementById('pay-button').onclick = function (e) {
                                        e.preventDefault();
                                        fetch('/api/payments/create-order', {
                                            method: 'POST'
                                        })
                                            .then(response => response.json())
                                            .then(order => {
                                                const options = {
                                                    key: "rzp_test_RTq0pZ3gH0hMCJ", // Replace with your Razorpay API Key
                                                    amount: order.amount, // Amount in paise
                                                    currency: order.currency,
                                                    name: "Apni Dukaan",
                                                    description: "Test Transaction",
                                                    order_id: order.id,
                                                    handler: function (response) {
                                                       // Notify backend
                                                        fetch('/api/payments/payment-success', {
                                                            method: 'POST',
                                                            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                                                            body: 'paymentId=' + response.razorpay_payment_id
                                                        })
                                                        .then(res => res.text())
                                                        .then(msg => {
                                                            alert("âœ… " + msg);
                                                            window.location.href = "/user/ordersummary"; // redirect to summary page
                                                        });
                                                    },
                                                    theme: {
                                                        color: "#3399cc"
                                                    }
                                                };
                                                const rzp = new Razorpay(options);
                                                rzp.open();
                                            })
                                            .catch(err => console.error(err));
                                    };
                                </script>



                            </div>
                       </form>


                    </section>
                </main>
            </div>
        </div>
    </div>
</body>

</html>