<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">
<head>
    <title>Orders</title>
</head>
<body>
<div layout:fragment="content" class="min-h-screen bg-red-300 py-8">

    <!-- Stepper -->
    <div class="max-w-6xl mx-auto px-4 pt-8 pb-4">
        <ol id="stepper" class="flex items-center w-full text-sm font-medium text-center text-gray-500 sm:text-base">
            <li class="flex-1 flex items-center after:content-[''] after:flex-1 after:border-b-2 after:mx-2" id="step-1">
                <span class="flex items-center gap-2">
                    <span class="w-7 h-7 flex items-center justify-center rounded-full step-circle">1</span>
                    Shipping
                </span>
            </li>
            <li class="flex-1 flex items-center after:content-[''] after:flex-1 after:border-b-2 after:mx-2" id="step-2">
                <span class="flex items-center gap-2">
                    <span class="w-7 h-7 flex items-center justify-center rounded-full step-circle">2</span>
                    Payment
                </span>
            </li>
            <li class="flex-1 flex items-center" id="step-3">
                <span class="flex items-center gap-2">
                    <span class="w-7 h-7 flex items-center justify-center rounded-full step-circle">3</span>
                    Order Summary
                </span>
            </li>
        </ol>
    </div>

    <style>
        .step-circle { background-color: #d1d5db; color: #4b5563; }
        .active-step .step-circle { background-color: #020408; color: #fff; }
        .active-step { color: #020408; }
        .active-step + li .after\:border-b-2 { border-color: #020408 !important; }
    </style>

    <script>
        let currentStep = 3;
        const totalSteps = 3;
        function updateStepper() {
            for (let i = 1; i <= totalSteps; i++) {
                const step = document.getElementById('step-' + i);
                if (i === currentStep) step.classList.add('active-step');
                else step.classList.remove('active-step');
            }
        }
        document.addEventListener('DOMContentLoaded', updateStepper);
    </script>

    <!-- Order Summary Layout -->
    <main class="max-w-7xl mx-auto py-8 px-4">
        <!-- Page Title -->
        <div class="mb-8">
            <h1 class="text-2xl font-bold text-gray-900">Your Orders</h1>
            <p class="text-gray-600">Track and manage your orders</p>
        </div>

        <!-- Orders List -->
        <div class="space-y-6">
            <!-- No Orders Message -->
            <div th:if="${#lists.isEmpty(orders)}" class="bg-white rounded-xl shadow p-8 text-center">
                <img src="https://img.icons8.com/pulsar-line/96/000000/shopping-bag.png" class="mx-auto mb-4" alt="Empty cart"/>
                <div class="text-gray-500 text-lg mb-4">No orders found</div>
                <a href="/user/main" class="inline-block bg-red-800 text-white px-6 py-2 rounded-lg hover:bg-gray-900 transition duration-200">
                    Start Shopping
                </a>
            </div>

            <!-- Orders List -->
            <div th:each="order : ${orders}" class="bg-white rounded-xl shadow overflow-hidden">
                <!-- Order Header -->
                <div class="bg-gray-50 p-4 border-b flex justify-between items-center">
                    <div>
                        <div class="text-sm text-gray-600">Order Id</div>
                        <div class="font-medium" th:text="${order.orderId}">ORD123456</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-600">Order Date</div>
                        <div class="font-medium" th:text="${#temporals.format(order.orderDate, 'dd MMM yyyy')}">17 Oct 2025</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-600">Total Amount</div>
                        <div class="font-medium">₹<span th:text="${#numbers.formatDecimal(order.totalAmount + 50, 0, 'COMMA', 0, 'POINT')}">499.00</span></div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-600">Status</div>
                        <div class="font-medium" th:text="${order.orderStatus}">Processing</div>
                    </div>
                </div>

                <!-- Order Items -->
                <div class="p-4" th:each="item : ${order.orderItems}">
                    <div class="flex items-center gap-4 py-4 border-b last:border-0">
                      

                         <img th:if="${item.product.images != null and item.product.images != ''}" 
                            th:src="@{${item.product.images}}"
                            class="w-20 h-20  object-cover rounded-md flex-shrink-0"
                            loading="lazy"
                             alt="Product Image" />

                        <div class="flex-1">
                            <h3 class="font-medium" th:text="${item.product.name}">Product Name</h3>
                            <div class="text-sm text-gray-500 mt-1">
                                <span th:if="${item.size}" th:text="'Size: ' + ${item.size}">Size: M</span>
                                <span th:text="'Quantity: ' + ${item.quantity}" class="ml-3">Quantity: 1</span>
                            </div>
                            <div class="mt-2">
                                <span class="font-medium">₹<span th:text="${#numbers.formatDecimal(item.sellingPrice, 0, 'COMMA', 0, 'POINT')}">199</span></span>
                                <span th:if="${item.sellingPrice < item.mrpPrice}" class="text-sm text-gray-500 line-through ml-2">
                                    ₹<span th:text="${#numbers.formatDecimal(item.mrpPrice, 0, 'COMMA', 0, 'POINT')}">299</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="bg-gray-50 p-4 border-t">
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Subtotal:</span>
                            <span>₹<span th:text="${#numbers.formatDecimal(order.totalSellingPrice, 0, 'COMMA', 0, 'POINT')}">598</span></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Discount:</span>
                            <span class="text-green-600">-₹<span th:text="${#numbers.formatDecimal(order.discount, 0, 'COMMA', 0, 'POINT')}">99</span></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Delivery Charge:</span>
                            <span>+₹<span th:text="${#numbers.formatDecimal(order.deliveryCharge, 0, 'COMMA', 0, 'POINT')}">40</span></span>
                        </div>
                        <div class="flex justify-between font-medium pt-2 border-t">
                            <span>Total:</span>
                            <span>₹<span th:text="${#numbers.formatDecimal(order.totalAmount + 50, 0, 'COMMA', 0, 'POINT')}">539</span></span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-3 space-x-2">
                        <a th:href="@{/user/orders/{id}(id=${order.id})}" class="px-4 py-2 text-sm font-medium text-white bg-red-800 hover:bg-blue-600 rounded-lg transition">
                            View Details
                        </a>
                        <!-- <a th:href="@{/user/orders/cancel/{id}(id=${order.id})}" th:if="${order.orderStatus != 'DELIVERED' and order.orderStatus != 'CANCELLED'}"
                              
                                class="px-4 py-2 text-sm font-medium text-white bg-gray-900 hover:bg-red-100 rounded-lg transition">
                            Cancel Order
                        </a> -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Cancel Order Script -->
        <script th:inline="javascript">
            function cancelOrder(orderId) {
                if (confirm('Are you sure you want to cancel this order?')) {
                    fetch(`/api/orders/${orderId}/cancel`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'}
                    })
                    .then(res => res.json())
                    .then(data => {
                        if(data.success) window.location.reload();
                        else alert('Failed: ' + data.message);
                    })
                    .catch(err => { console.error(err); alert('Error canceling order'); });
                }
            }
        </script>
    </main>

</div>
</body>
</html>
